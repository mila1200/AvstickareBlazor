@inherits LayoutComponentBase
@using MudBlazor
@inject NavigationManager NavManager
@implements IDisposable

<MudThemeProvider Theme="AvstickareCustomTheme" />
<MudDialogProvider />
<MudSnackbarProvider />
<MudPopoverProvider />

<MudLayout>
    <!--matar in drawertoggle till header-komponenten-->
    <Header OnDrawerToggle="DrawerToggle" />

    <MudDrawer @bind-Open="_drawerOpen" Style="background-color: #F8F9FA; color: #000000;">
        <NavMenu />
    </MudDrawer>

    <!--Bort med mudcontiner för att få bort padding vid kartläge-->
    @if (CurrentPath == "karta")
    {
        <MudMainContent Class="p-0">
            @Body
        </MudMainContent>
    }
    else
    {
        <MudMainContent>
            @Body
        </MudMainContent>
    }

    <!--Göms vid större skärmar Breakpoint 960px-->
    <MudHidden Breakpoint="Breakpoint.SmAndUp">
        <Footer />
    </MudHidden>
</MudLayout>


@code {

    bool _drawerOpen = true;

    private string? CurrentPath;

    protected override void OnInitialized()
    {
        NavManager.LocationChanged += OnLocationChanged;
        UpdateUrl();
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        UpdateUrl();
        StateHasChanged();
    }

    private void UpdateUrl()
    {
        //tar bara ut sökvägen, t.ex. "karta" från hela URL:en
        CurrentPath = NavManager.ToBaseRelativePath(NavManager.Uri).Split('?')[0];
    }

    public void Dispose()
    {
        NavManager.LocationChanged -= OnLocationChanged;
    }

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    MudTheme AvstickareCustomTheme = new MudTheme()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#009688",
            Secondary = "#223843",
            Tertiary = "#FFD54F",
            Background = "#F8F9FA",
        },
        Typography = new Typography()
        {
            Default = new DefaultTypography()
            {
                FontFamily = new[] { "Nunito", "Helvetica", "Arial", "sans-serif" }
            }
        }
    };
}